import{_ as n,o as s,c as a,e as p}from"./app-e0d227af.js";const t={},e=p(`<h1 id="redis集群-cluster" tabindex="-1"><a class="header-anchor" href="#redis集群-cluster" aria-hidden="true">#</a> Redis集群（Cluster）</h1><p>redis集群是一个又多个<strong>主从节点群</strong>组成的<strong>分布式服务器群</strong>，它具有<strong>复制、高可用和分片</strong>的特性。<br> redis集群不需要sentinel哨兵也能完成节点移除和故障转移的功能。需要将每个节点设置成集群模式，这种集群模式没有中心节点，可水平扩展。<br> 根据官方文档称，可线性扩展到上万个节点（推荐不超过1W个节点）。<br> redis集群的性能和高可用性均优于<strong>哨兵模式</strong>，且配置简单。</p><h2 id="原理分析" tabindex="-1"><a class="header-anchor" href="#原理分析" aria-hidden="true">#</a> 原理分析</h2><p>Redis Cluster将所有数据划分为16384个槽位（slots），每个节点负责其中一部分槽位。槽位信息存储在每一个节点中。</p><p>当Redis Cluster的客户端来连接集群时，它也会得到一份集群的槽位配置信息并将其缓存在客户端本地。如此一来当客户端要查找某个key时，可以直接地你个为到目标节点。<br> 而因为槽位的信息可能会存在客户端与服务器不一致的情况，因此还实现了<strong>纠正机制</strong>来实现槽位信息的校验调整。</p><h3 id="槽位定位" tabindex="-1"><a class="header-anchor" href="#槽位定位" aria-hidden="true">#</a> 槽位定位</h3><p>Redis Cluster默认对key使用crc16算法进行hash后得到一个整数值，然后用这个整数值对16384个槽位进行取模后获取具体的槽位。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code># <span class="token class-name">JedisClusterCRC16</span> 核心源码实现

<span class="token keyword">package</span> <span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>util</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">JedisClusterCRC16</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">LOOKUP_TABLE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4129</span><span class="token punctuation">,</span> <span class="token number">8258</span><span class="token punctuation">,</span> <span class="token number">12387</span><span class="token punctuation">,</span> <span class="token number">16516</span><span class="token punctuation">,</span> <span class="token number">20645</span><span class="token punctuation">,</span> <span class="token number">24774</span><span class="token punctuation">,</span> <span class="token number">28903</span><span class="token punctuation">,</span> <span class="token number">33032</span><span class="token punctuation">,</span> <span class="token number">37161</span><span class="token punctuation">,</span> <span class="token number">41290</span><span class="token punctuation">,</span> <span class="token number">45419</span><span class="token punctuation">,</span> <span class="token number">49548</span><span class="token punctuation">,</span> <span class="token number">53677</span><span class="token punctuation">,</span> <span class="token number">57806</span><span class="token punctuation">,</span> <span class="token number">61935</span><span class="token punctuation">,</span> <span class="token number">4657</span><span class="token punctuation">,</span> <span class="token number">528</span><span class="token punctuation">,</span> <span class="token number">12915</span><span class="token punctuation">,</span> <span class="token number">8786</span><span class="token punctuation">,</span> <span class="token number">21173</span><span class="token punctuation">,</span> <span class="token number">17044</span><span class="token punctuation">,</span> <span class="token number">29431</span><span class="token punctuation">,</span> <span class="token number">25302</span><span class="token punctuation">,</span> <span class="token number">37689</span><span class="token punctuation">,</span> <span class="token number">33560</span><span class="token punctuation">,</span> <span class="token number">45947</span><span class="token punctuation">,</span> <span class="token number">41818</span><span class="token punctuation">,</span> <span class="token number">54205</span><span class="token punctuation">,</span> <span class="token number">50076</span><span class="token punctuation">,</span> <span class="token number">62463</span><span class="token punctuation">,</span> <span class="token number">58334</span><span class="token punctuation">,</span> <span class="token number">9314</span><span class="token punctuation">,</span> <span class="token number">13379</span><span class="token punctuation">,</span> <span class="token number">1056</span><span class="token punctuation">,</span> <span class="token number">5121</span><span class="token punctuation">,</span> <span class="token number">25830</span><span class="token punctuation">,</span> <span class="token number">29895</span><span class="token punctuation">,</span> <span class="token number">17572</span><span class="token punctuation">,</span> <span class="token number">21637</span><span class="token punctuation">,</span> <span class="token number">42346</span><span class="token punctuation">,</span> <span class="token number">46411</span><span class="token punctuation">,</span> <span class="token number">34088</span><span class="token punctuation">,</span> <span class="token number">38153</span><span class="token punctuation">,</span> <span class="token number">58862</span><span class="token punctuation">,</span> <span class="token number">62927</span><span class="token punctuation">,</span> <span class="token number">50604</span><span class="token punctuation">,</span> <span class="token number">54669</span><span class="token punctuation">,</span> <span class="token number">13907</span><span class="token punctuation">,</span> <span class="token number">9842</span><span class="token punctuation">,</span> <span class="token number">5649</span><span class="token punctuation">,</span> <span class="token number">1584</span><span class="token punctuation">,</span> <span class="token number">30423</span><span class="token punctuation">,</span> <span class="token number">26358</span><span class="token punctuation">,</span> <span class="token number">22165</span><span class="token punctuation">,</span> <span class="token number">18100</span><span class="token punctuation">,</span> <span class="token number">46939</span><span class="token punctuation">,</span> <span class="token number">42874</span><span class="token punctuation">,</span> <span class="token number">38681</span><span class="token punctuation">,</span> <span class="token number">34616</span><span class="token punctuation">,</span> <span class="token number">63455</span><span class="token punctuation">,</span> <span class="token number">59390</span><span class="token punctuation">,</span> <span class="token number">55197</span><span class="token punctuation">,</span> <span class="token number">51132</span><span class="token punctuation">,</span> <span class="token number">18628</span><span class="token punctuation">,</span> <span class="token number">22757</span><span class="token punctuation">,</span> <span class="token number">26758</span><span class="token punctuation">,</span> <span class="token number">30887</span><span class="token punctuation">,</span> <span class="token number">2112</span><span class="token punctuation">,</span> <span class="token number">6241</span><span class="token punctuation">,</span> <span class="token number">10242</span><span class="token punctuation">,</span> <span class="token number">14371</span><span class="token punctuation">,</span> <span class="token number">51660</span><span class="token punctuation">,</span> <span class="token number">55789</span><span class="token punctuation">,</span> <span class="token number">59790</span><span class="token punctuation">,</span> <span class="token number">63919</span><span class="token punctuation">,</span> <span class="token number">35144</span><span class="token punctuation">,</span> <span class="token number">39273</span><span class="token punctuation">,</span> <span class="token number">43274</span><span class="token punctuation">,</span> <span class="token number">47403</span><span class="token punctuation">,</span> <span class="token number">23285</span><span class="token punctuation">,</span> <span class="token number">19156</span><span class="token punctuation">,</span> <span class="token number">31415</span><span class="token punctuation">,</span> <span class="token number">27286</span><span class="token punctuation">,</span> <span class="token number">6769</span><span class="token punctuation">,</span> <span class="token number">2640</span><span class="token punctuation">,</span> <span class="token number">14899</span><span class="token punctuation">,</span> <span class="token number">10770</span><span class="token punctuation">,</span> <span class="token number">56317</span><span class="token punctuation">,</span> <span class="token number">52188</span><span class="token punctuation">,</span> <span class="token number">64447</span><span class="token punctuation">,</span> <span class="token number">60318</span><span class="token punctuation">,</span> <span class="token number">39801</span><span class="token punctuation">,</span> <span class="token number">35672</span><span class="token punctuation">,</span> <span class="token number">47931</span><span class="token punctuation">,</span> <span class="token number">43802</span><span class="token punctuation">,</span> <span class="token number">27814</span><span class="token punctuation">,</span> <span class="token number">31879</span><span class="token punctuation">,</span> <span class="token number">19684</span><span class="token punctuation">,</span> <span class="token number">23749</span><span class="token punctuation">,</span> <span class="token number">11298</span><span class="token punctuation">,</span> <span class="token number">15363</span><span class="token punctuation">,</span> <span class="token number">3168</span><span class="token punctuation">,</span> <span class="token number">7233</span><span class="token punctuation">,</span> <span class="token number">60846</span><span class="token punctuation">,</span> <span class="token number">64911</span><span class="token punctuation">,</span> <span class="token number">52716</span><span class="token punctuation">,</span> <span class="token number">56781</span><span class="token punctuation">,</span> <span class="token number">44330</span><span class="token punctuation">,</span> <span class="token number">48395</span><span class="token punctuation">,</span> <span class="token number">36200</span><span class="token punctuation">,</span> <span class="token number">40265</span><span class="token punctuation">,</span> <span class="token number">32407</span><span class="token punctuation">,</span> <span class="token number">28342</span><span class="token punctuation">,</span> <span class="token number">24277</span><span class="token punctuation">,</span> <span class="token number">20212</span><span class="token punctuation">,</span> <span class="token number">15891</span><span class="token punctuation">,</span> <span class="token number">11826</span><span class="token punctuation">,</span> <span class="token number">7761</span><span class="token punctuation">,</span> <span class="token number">3696</span><span class="token punctuation">,</span> <span class="token number">65439</span><span class="token punctuation">,</span> <span class="token number">61374</span><span class="token punctuation">,</span> <span class="token number">57309</span><span class="token punctuation">,</span> <span class="token number">53244</span><span class="token punctuation">,</span> <span class="token number">48923</span><span class="token punctuation">,</span> <span class="token number">44858</span><span class="token punctuation">,</span> <span class="token number">40793</span><span class="token punctuation">,</span> <span class="token number">36728</span><span class="token punctuation">,</span> <span class="token number">37256</span><span class="token punctuation">,</span> <span class="token number">33193</span><span class="token punctuation">,</span> <span class="token number">45514</span><span class="token punctuation">,</span> <span class="token number">41451</span><span class="token punctuation">,</span> <span class="token number">53516</span><span class="token punctuation">,</span> <span class="token number">49453</span><span class="token punctuation">,</span> <span class="token number">61774</span><span class="token punctuation">,</span> <span class="token number">57711</span><span class="token punctuation">,</span> <span class="token number">4224</span><span class="token punctuation">,</span> <span class="token number">161</span><span class="token punctuation">,</span> <span class="token number">12482</span><span class="token punctuation">,</span> <span class="token number">8419</span><span class="token punctuation">,</span> <span class="token number">20484</span><span class="token punctuation">,</span> <span class="token number">16421</span><span class="token punctuation">,</span> <span class="token number">28742</span><span class="token punctuation">,</span> <span class="token number">24679</span><span class="token punctuation">,</span> <span class="token number">33721</span><span class="token punctuation">,</span> <span class="token number">37784</span><span class="token punctuation">,</span> <span class="token number">41979</span><span class="token punctuation">,</span> <span class="token number">46042</span><span class="token punctuation">,</span> <span class="token number">49981</span><span class="token punctuation">,</span> <span class="token number">54044</span><span class="token punctuation">,</span> <span class="token number">58239</span><span class="token punctuation">,</span> <span class="token number">62302</span><span class="token punctuation">,</span> <span class="token number">689</span><span class="token punctuation">,</span> <span class="token number">4752</span><span class="token punctuation">,</span> <span class="token number">8947</span><span class="token punctuation">,</span> <span class="token number">13010</span><span class="token punctuation">,</span> <span class="token number">16949</span><span class="token punctuation">,</span> <span class="token number">21012</span><span class="token punctuation">,</span> <span class="token number">25207</span><span class="token punctuation">,</span> <span class="token number">29270</span><span class="token punctuation">,</span> <span class="token number">46570</span><span class="token punctuation">,</span> <span class="token number">42443</span><span class="token punctuation">,</span> <span class="token number">38312</span><span class="token punctuation">,</span> <span class="token number">34185</span><span class="token punctuation">,</span> <span class="token number">62830</span><span class="token punctuation">,</span> <span class="token number">58703</span><span class="token punctuation">,</span> <span class="token number">54572</span><span class="token punctuation">,</span> <span class="token number">50445</span><span class="token punctuation">,</span> <span class="token number">13538</span><span class="token punctuation">,</span> <span class="token number">9411</span><span class="token punctuation">,</span> <span class="token number">5280</span><span class="token punctuation">,</span> <span class="token number">1153</span><span class="token punctuation">,</span> <span class="token number">29798</span><span class="token punctuation">,</span> <span class="token number">25671</span><span class="token punctuation">,</span> <span class="token number">21540</span><span class="token punctuation">,</span> <span class="token number">17413</span><span class="token punctuation">,</span> <span class="token number">42971</span><span class="token punctuation">,</span> <span class="token number">47098</span><span class="token punctuation">,</span> <span class="token number">34713</span><span class="token punctuation">,</span> <span class="token number">38840</span><span class="token punctuation">,</span> <span class="token number">59231</span><span class="token punctuation">,</span> <span class="token number">63358</span><span class="token punctuation">,</span> <span class="token number">50973</span><span class="token punctuation">,</span> <span class="token number">55100</span><span class="token punctuation">,</span> <span class="token number">9939</span><span class="token punctuation">,</span> <span class="token number">14066</span><span class="token punctuation">,</span> <span class="token number">1681</span><span class="token punctuation">,</span> <span class="token number">5808</span><span class="token punctuation">,</span> <span class="token number">26199</span><span class="token punctuation">,</span> <span class="token number">30326</span><span class="token punctuation">,</span> <span class="token number">17941</span><span class="token punctuation">,</span> <span class="token number">22068</span><span class="token punctuation">,</span> <span class="token number">55628</span><span class="token punctuation">,</span> <span class="token number">51565</span><span class="token punctuation">,</span> <span class="token number">63758</span><span class="token punctuation">,</span> <span class="token number">59695</span><span class="token punctuation">,</span> <span class="token number">39368</span><span class="token punctuation">,</span> <span class="token number">35305</span><span class="token punctuation">,</span> <span class="token number">47498</span><span class="token punctuation">,</span> <span class="token number">43435</span><span class="token punctuation">,</span> <span class="token number">22596</span><span class="token punctuation">,</span> <span class="token number">18533</span><span class="token punctuation">,</span> <span class="token number">30726</span><span class="token punctuation">,</span> <span class="token number">26663</span><span class="token punctuation">,</span> <span class="token number">6336</span><span class="token punctuation">,</span> <span class="token number">2273</span><span class="token punctuation">,</span> <span class="token number">14466</span><span class="token punctuation">,</span> <span class="token number">10403</span><span class="token punctuation">,</span> <span class="token number">52093</span><span class="token punctuation">,</span> <span class="token number">56156</span><span class="token punctuation">,</span> <span class="token number">60223</span><span class="token punctuation">,</span> <span class="token number">64286</span><span class="token punctuation">,</span> <span class="token number">35833</span><span class="token punctuation">,</span> <span class="token number">39896</span><span class="token punctuation">,</span> <span class="token number">43963</span><span class="token punctuation">,</span> <span class="token number">48026</span><span class="token punctuation">,</span> <span class="token number">19061</span><span class="token punctuation">,</span> <span class="token number">23124</span><span class="token punctuation">,</span> <span class="token number">27191</span><span class="token punctuation">,</span> <span class="token number">31254</span><span class="token punctuation">,</span> <span class="token number">2801</span><span class="token punctuation">,</span> <span class="token number">6864</span><span class="token punctuation">,</span> <span class="token number">10931</span><span class="token punctuation">,</span> <span class="token number">14994</span><span class="token punctuation">,</span> <span class="token number">64814</span><span class="token punctuation">,</span> <span class="token number">60687</span><span class="token punctuation">,</span> <span class="token number">56684</span><span class="token punctuation">,</span> <span class="token number">52557</span><span class="token punctuation">,</span> <span class="token number">48554</span><span class="token punctuation">,</span> <span class="token number">44427</span><span class="token punctuation">,</span> <span class="token number">40424</span><span class="token punctuation">,</span> <span class="token number">36297</span><span class="token punctuation">,</span> <span class="token number">31782</span><span class="token punctuation">,</span> <span class="token number">27655</span><span class="token punctuation">,</span> <span class="token number">23652</span><span class="token punctuation">,</span> <span class="token number">19525</span><span class="token punctuation">,</span> <span class="token number">15522</span><span class="token punctuation">,</span> <span class="token number">11395</span><span class="token punctuation">,</span> <span class="token number">7392</span><span class="token punctuation">,</span> <span class="token number">3265</span><span class="token punctuation">,</span> <span class="token number">61215</span><span class="token punctuation">,</span> <span class="token number">65342</span><span class="token punctuation">,</span> <span class="token number">53085</span><span class="token punctuation">,</span> <span class="token number">57212</span><span class="token punctuation">,</span> <span class="token number">44955</span><span class="token punctuation">,</span> <span class="token number">49082</span><span class="token punctuation">,</span> <span class="token number">36825</span><span class="token punctuation">,</span> <span class="token number">40952</span><span class="token punctuation">,</span> <span class="token number">28183</span><span class="token punctuation">,</span> <span class="token number">32310</span><span class="token punctuation">,</span> <span class="token number">20053</span><span class="token punctuation">,</span> <span class="token number">24180</span><span class="token punctuation">,</span> <span class="token number">11923</span><span class="token punctuation">,</span> <span class="token number">16050</span><span class="token punctuation">,</span> <span class="token number">3793</span><span class="token punctuation">,</span> <span class="token number">7920</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">JedisClusterCRC16</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InstantiationError</span><span class="token punctuation">(</span><span class="token string">&quot;Must not instantiate this class&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">getSlot</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        key <span class="token operator">=</span> <span class="token class-name">JedisClusterHashTagUtil</span><span class="token punctuation">.</span><span class="token function">getHashTag</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">getCRC16</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">16383</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
    * 获取key所在的槽位
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">getSlot</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> e <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> sFound <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> key<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">123</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>sFound<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                s <span class="token operator">=</span> i<span class="token punctuation">;</span>
                sFound <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">125</span> <span class="token operator">&amp;&amp;</span> sFound<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e <span class="token operator">=</span> i<span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> s <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> e <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> e <span class="token operator">!=</span> s <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token function">getCRC16</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> s <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">16383</span> <span class="token operator">:</span> <span class="token function">getCRC16</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">16383</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">getCRC16</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes<span class="token punctuation">,</span> <span class="token keyword">int</span> s<span class="token punctuation">,</span> <span class="token keyword">int</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> crc <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> s<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> e<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            crc <span class="token operator">=</span> crc <span class="token operator">&lt;&lt;</span> <span class="token number">8</span> <span class="token operator">^</span> <span class="token constant">LOOKUP_TABLE</span><span class="token punctuation">[</span><span class="token punctuation">(</span>crc <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">8</span> <span class="token operator">^</span> bytes<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> crc <span class="token operator">&amp;</span> <span class="token char">&#39;\\uffff&#39;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">getCRC16</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">getCRC16</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> bytes<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">getCRC16</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytesKey <span class="token operator">=</span> <span class="token class-name">SafeEncoder</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">getCRC16</span><span class="token punctuation">(</span>bytesKey<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> bytesKey<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="跳转重定位" tabindex="-1"><a class="header-anchor" href="#跳转重定位" aria-hidden="true">#</a> 跳转重定位</h3><p>当客户端像一个节点发出指令，而该节点发现key所在槽位已经不归自己管理时，它会向客户端发送一个特殊的跳转指令，指令携带了目标操作的节点地址让客户端去该节点进行操作。<br> 客户端收到指令后连接新的节点进行操作，并且会同步更新本地的槽位映射表缓存，后续所有key使用新槽位映射表数据进行操作。</p><h2 id="集群节点间通信" tabindex="-1"><a class="header-anchor" href="#集群节点间通信" aria-hidden="true">#</a> 集群节点间通信</h2><p>维护继集群元数据有两种方式：<strong>集中式</strong> 和 <strong>gossip</strong>，而Redis Cluster节点间采用gossip协议进行通信。</p><h3 id="集中式" tabindex="-1"><a class="header-anchor" href="#集中式" aria-hidden="true">#</a> 集中式</h3><p>集中式协议的优点就是对元数据的更新和读取时效性好，一旦元数据出现变更立即更新到集中式的存储中，其他节点读取时立即就可以感知获取最新的元数据。 但由于所有的元数据集中在一个地方，会存在数据更新、存储照成一点的影响。</p><p>很多中间件在使用集中式存储元数据时，通常借助zookeeper来实现。</p><h3 id="gossip" tabindex="-1"><a class="header-anchor" href="#gossip" aria-hidden="true">#</a> gossip</h3><p>gossip协议的优点在于元数据更新比较分散，更新的请求是陆陆续续到达各节点，相比集中式协议没有更新上的压力。但是分散式更新是陆陆续续到达的，有一定的延迟，元数据更新延迟有可能导致集群的额一些操作有一些滞后。</p><p>gossip协议会包含各种信息，例如ping、pong、meet、fail等</p><ul><li><strong>meet</strong>：节点发送meet给新加入的节点，包含了集群的元数据信息，新节点读取数据就会加入集群中开始与其他节点进行通信；</li><li><strong>ping</strong>：每个节点都会经常经常性的给其他节点发送ping命令，其中包含自己的状态还有自己维护的集群元数据，通过ping互相交换元数据；</li><li><strong>pong</strong>：对ping和meet消息的返回，包含自己的状态和其他信息，也可以用于消息广播和更新；</li><li><strong>fail</strong>：某个节点判断另一个节点fail之后，就发送fail给其他节点，通知其他节点该节点宕机了；</li></ul>`,19),o=[e];function c(u,l){return s(),a("div",null,o)}const i=n(t,[["render",c],["__file","2305091744.html.vue"]]);export{i as default};
